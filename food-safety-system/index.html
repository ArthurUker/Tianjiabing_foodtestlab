<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>食品安全检验管理系统 (Pro)</title>
    <!-- 样式库 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="./css/style.css">
    
    <!-- 脚本库 (defer 延迟加载) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <!-- PDF 导出库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script type="module" src="js/main.js"></script>
</head>
<body class="bg-gray-50">

    <!-- 顶部导航 -->
    <nav class="bg-blue-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <i class="fas fa-shield-alt text-2xl"></i>
                <h1 class="text-xl font-bold">田家炳中学食品安全检验管理系统</h1>
            </div>
            <div class="text-sm"><i class="far fa-user"></i> 郭博 (管理员)</div>
        </div>
    </nav>

    <!-- 主容器 -->
    <div class="container mx-auto px-4 py-6 flex gap-6">
        
        <!-- 左侧菜单 -->
        <div class="bg-gray-800 text-white w-64 flex-shrink-0 hidden md:block rounded-lg shadow-lg h-screen sticky top-4">
            <div class="p-4 border-b border-gray-700">
                <h1 class="text-xl font-bold">检测系统</h1>
                <p class="text-xs text-gray-400 mt-1">Version 2.0 (Modular)</p>
            </div>
            <nav class="p-2 space-y-1">
                <button class="nav-btn active w-full text-left px-4 py-2 rounded hover:bg-blue-700 flex items-center" data-target="dashboard">
                    <i class="fas fa-tachometer-alt mr-3 w-5"></i>数据看板
                </button>
                <button class="nav-btn w-full text-left px-4 py-2 rounded hover:bg-blue-700 flex items-center" data-target="tableware-test">
                    <i class="fas fa-utensils mr-3 w-5"></i>餐具洁净度
                </button>
                <button class="nav-btn w-full text-left px-4 py-2 rounded hover:bg-blue-700 flex items-center" data-target="pesticide-test">
                    <i class="fas fa-seedling mr-3 w-5"></i>果蔬农残
                </button>
                <button class="nav-btn w-full text-left px-4 py-2 rounded hover:bg-blue-700 flex items-center" data-target="oil-test">
                    <i class="fas fa-oil-can mr-3 w-5"></i>食用油品质
                </button>
                <button class="nav-btn w-full text-left px-4 py-2 rounded hover:bg-blue-700 flex items-center" data-target="lean-meat-test">
                    <i class="fas fa-drumstick-bite mr-3 w-5"></i>肉、蛋农残检测
                </button>
                <button class="nav-btn w-full text-left px-4 py-2 rounded hover:bg-blue-700 flex items-center" data-target="pathogen-test">
                    <i class="fas fa-virus mr-3 w-5"></i>病原体检测
                </button>
                <div class="border-t border-gray-700 my-2"></div>
                <button class="nav-btn w-full text-left px-4 py-2 rounded hover:bg-blue-700 flex items-center" data-target="export-data">
                    <i class="fas fa-file-export mr-3 w-5"></i>数据导出
                </button>
            </nav>
        </div>

        <!-- 右侧内容 -->
        <div class="flex-1 min-w-0">
            
            <!-- 1. 看板 -->
            <div id="dashboard" class="content-section">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">实时数据概览</h2>
                        <button id="btnExportDashboard" class="px-4 py-2 bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition">
                            <i class="fas fa-download mr-2"></i>导出看板PDF
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="bg-blue-500 rounded-lg p-4 text-white shadow">
                            <p class="opacity-90 text-sm">餐具洁净度</p>
                            <p class="text-3xl font-bold" id="card_tableware_count">0</p>
                            <p class="text-xs">合格率: <span id="card_tableware_pass">0%</span></p>
                        </div>
                        <div class="bg-green-500 rounded-lg p-4 text-white shadow">
                            <p class="opacity-90 text-sm">果蔬农残</p>
                            <p class="text-3xl font-bold" id="card_pesticide_count">0</p>
                            <p class="text-xs">合格率: <span id="card_pesticide_pass">0%</span></p>
                        </div>
                        <div class="bg-yellow-500 rounded-lg p-4 text-white shadow">
                            <p class="opacity-90 text-sm">食用油品质</p>
                            <p class="text-3xl font-bold" id="card_oil_count">0</p>
                            <p class="text-xs">合格率: <span id="card_oil_pass">0%</span></p>
                        </div>
                        <div class="bg-red-500 rounded-lg p-4 text-white shadow">
                            <p class="opacity-90 text-sm">瘦肉精</p>
                            <p class="text-3xl font-bold" id="card_lean_count">0</p>
                            <p class="text-xs">合格率: <span id="card_lean_pass">0%</span></p>
                        </div>
                    </div>
                    <div class="text-right text-gray-500">
                        总检测样本数: <span id="card_total_count" class="font-bold text-xl text-gray-800">0</span>
                    </div>
                </div>
            </div>


            <!-- 2. 餐具检测 -->
            <div id="tableware-test" class="content-section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold mb-4 border-b pb-2">餐具洁净度检测 (ATP)</h2>
                    <form id="tablewareTestForm" class="space-y-4 mb-6">
                        <div class="grid grid-cols-3 gap-4">
                            <input type="date" name="testDate" required class="border p-2 rounded">
                            <select name="canteen" class="border p-2 rounded"><option>一食堂</option><option>二食堂</option></select>
                            <input type="text" name="inspector" placeholder="检测员" required class="border p-2 rounded">
                        </div>
                        <div id="atpPointsContainer">
                            <div class="border p-4 bg-gray-50 atp-point rounded mb-2">
                                <div class="grid grid-cols-4 gap-4">
                                    <select name="location" class="border p-2 rounded"><option>餐具表面</option><option>操作台</option></select>
                                    <input type="number" name="rluValue" placeholder="RLU值" class="border p-2 rounded">
                                    <select name="result" class="border p-2 rounded"><option>合格</option><option>不合格</option></select>
                                    <span class="text-xs text-gray-400 pt-3">默认</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button type="button" id="btnAddAtpPoint" class="px-4 py-2 bg-green-500 text-white rounded">添加点位</button>
                            <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded">保存</button>
                        </div>
                    </form>
                    <table class="w-full text-sm"><thead class="bg-gray-100"><tr><th class="p-2 border">日期</th><th class="p-2 border">食堂</th><th class="p-2 border">点位</th><th class="p-2 border">RLU</th><th class="p-2 border">结果</th><th class="p-2 border">操作</th></tr></thead><tbody id="tablewareRecords"></tbody></table>
                </div>
            </div>
            <!-- 3. 果蔬农残检测 -->
            <div id="pesticide-test" class="content-section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold mb-4 border-b pb-2">果蔬农残检测</h2>
                    <form id="pesticideTestForm" class="space-y-4 mb-6">
                        <!-- 第一行：基本信息字段 -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 p-5 bg-gray-50 rounded-lg border border-gray-200">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">检测日期 <span class="text-red-500">*</span></label>
                                <input type="date" name="testDate" required class="w-full border border-gray-300 p-2 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">食堂 <span class="text-red-500">*</span></label>
                                <select name="canteen" class="w-full border border-gray-300 p-2 rounded-md shadow-sm" required>
                                    <option value="一食堂">一食堂</option>
                                    <option value="二食堂">二食堂</option>
                                    <option value="三食堂">三食堂</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">检测员 <span class="text-red-500">*</span></label>
                                <input type="text" name="inspector" placeholder="输入姓名" required class="w-full border border-gray-300 p-2 rounded-md shadow-sm">
                            </div>
                        </div>
                        
                        <!-- 第二行：检测数据字段 -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 p-5 bg-gray-50 rounded-lg border border-gray-200">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">蔬菜品种 <span class="text-red-500">*</span></label>
                                <input type="text" name="vegetableType" placeholder="如：青菜、黄瓜等" required class="w-full border border-gray-300 p-2 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">检测项目 <span class="text-red-500">*</span></label>
                                <select name="batchNo" class="w-full border border-gray-300 p-2 rounded-md shadow-sm" required>
                                    <option value="克百威-胶体金检测卡">克百威-胶体金检测卡</option>
                                    <option value="水胺硫磷-胶体金检测卡">水胺硫磷-胶体金检测卡</option>
                                    <option value="通用显色试纸">通用显色试纸</option>
                                    <option value="二氧化硫显色试剂">二氧化硫显色试剂</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">检测结果 <span class="text-red-500">*</span></label>
                                <select name="result" class="w-full border border-gray-300 p-2 rounded-md shadow-sm" required>
                                    <option value="合格">合格</option>
                                    <option value="不合格">不合格</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="flex justify-end mt-4">
                            <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                                <i class="fas fa-save mr-2"></i>保存
                            </button>
                        </div>
                    </form>
                    <table class="w-full text-sm">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-2 border">日期</th>
                                <th class="p-2 border">食堂</th>
                                <th class="p-2 border">蔬菜品种</th>
                                <th class="p-2 border">检测项目</th>
                                <th class="p-2 border">结果</th>
                                <th class="p-2 border">检测员</th>
                                <th class="p-2 border">操作</th>
                            </tr>
                        </thead>
                        <tbody id="pesticideRecords"></tbody>
                    </table>
                </div>
            </div>


            <!-- 4. 食用油检测 -->
            <div id="oil-test" class="content-section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold mb-4 border-b pb-2">食用油品质检测</h2>
                    <form id="oilTestForm" class="space-y-4 mb-6">
                        <!-- 第一行：基本信息字段 -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 p-5 bg-gray-50 rounded-lg border border-gray-200">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">检测日期 <span class="text-red-500">*</span></label>
                                <input type="date" name="testDate" required class="w-full border border-gray-300 p-2 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">食堂 <span class="text-red-500">*</span></label>
                                <select name="canteen" class="w-full border border-gray-300 p-2 rounded-md shadow-sm" required>
                                    <option value="一食堂">一食堂</option>
                                    <option value="二食堂">二食堂</option>
                                    <option value="三食堂">三食堂</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">检测员 <span class="text-red-500">*</span></label>
                                <input type="text" name="inspector" placeholder="输入姓名" required class="w-full border border-gray-300 p-2 rounded-md shadow-sm">
                            </div>
                        </div>
                        
                        <!-- 第二行：检测数据字段 -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 p-5 bg-gray-50 rounded-lg border border-gray-200">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">检测油温(℃) <span class="text-red-500">*</span></label>
                                <input type="number" name="oilTemp" placeholder="输入当前油温" required class="w-full border border-gray-300 p-2 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">油品颜色 <span class="text-red-500">*</span></label>
                                <select name="tpmValue" id="oilColor" class="w-full border border-gray-300 p-2 rounded-md shadow-sm" required 
                                    <option value="0.0">浅黄色 </option>
                                    <option value="0.06">淡黄色 </option>
                                    <option value="0.13">微绿色 </option>
                                    <option value="0.20">浅绿色 </option>
                                    <option value="0.25">明显绿色 </option>
                                    <option value="0.30">深绿色 </option>
                                    <option value="0.60">蓝色 </option>
                                </select>
                                <p class="text-xs text-gray-500 mt-1">预估氧化值: <span id="tpmReference">0.0 g/100g</span></p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">品质等级 <span class="text-red-500">*</span></label>
                                <input type="text" name="colorLevel" id="oilQuality" readonly class="w-full border border-gray-300 p-2 rounded-md shadow-sm bg-gray-50" value="合格">
                            </div>
                        </div>
                        
                        <div class="flex justify-end mt-4">
                            <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                                <i class="fas fa-save mr-2"></i>保存
                            </button>
                        </div>
                    </form>
                    <table class="w-full text-sm">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-2 border">日期</th>
                                <th class="p-2 border">食堂</th>
                                <th class="p-2 border">油温</th>
                                <th class="p-2 border">TPM值</th>
                                <th class="p-2 border">品质等级</th>
                                <th class="p-2 border">检测员</th>
                                <th class="p-2 border">操作</th>
                            </tr>
                        </thead>
                        <tbody id="oilRecords"></tbody>
                    </table>
                </div>
            </div>

            <!-- 5. 肉、蛋农残检测 -->
            <div id="lean-meat-test" class="content-section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold mb-4 border-b pb-2">肉、蛋农残检测</h2>
                    <form id="leanMeatTestForm" class="space-y-4 mb-6">
                        <!-- 第一行：基本信息字段 -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 p-5 bg-gray-50 rounded-lg border border-gray-200">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">检测日期 <span class="text-red-500">*</span></label>
                                <input type="date" name="testDate" required class="w-full border border-gray-300 p-2 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">食堂 <span class="text-red-500">*</span></label>
                                <select name="canteen" class="w-full border border-gray-300 p-2 rounded-md shadow-sm" required>
                                    <option value="一食堂">一食堂</option>
                                    <option value="二食堂">二食堂</option>
                                    <option value="三食堂">三食堂</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">检测员 <span class="text-red-500">*</span></label>
                                <input type="text" name="inspector" placeholder="输入姓名" required class="w-full border border-gray-300 p-2 rounded-md shadow-sm">
                            </div>
                        </div>
                        
                        <!-- 第二行：检测数据字段 -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 p-5 bg-gray-50 rounded-lg border border-gray-200">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">肉类 <span class="text-red-500">*</span></label>
                                <select name="meatType" class="w-full border border-gray-300 p-2 rounded-md shadow-sm" required>
                                    <option value="猪肉">猪肉</option>
                                    <option value="牛肉">牛肉</option>
                                    <option value="羊肉">羊肉</option>
                                    <option value="禽肉">禽肉</option>
                                    <option value="鱼肉">鱼肉</option>
                                    <option value="禽蛋">禽蛋</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">检测项目 <span class="text-red-500">*</span></label>
                                <select name="batchNo" class="w-full border border-gray-300 p-2 rounded-md shadow-sm" required>
                                    <option value="恩诺沙星-胶体金检测卡">恩诺沙星-胶体金检测卡</option>
                                    <option value="氟苯尼考-胶体金检测卡">氟苯尼考-胶体金检测卡</option>
                                    <option value="盐酸克伦特罗-胶体金检测卡">盐酸克伦特罗-胶体金检测卡</option>
                                    <option value="莱克多巴胺-胶体金检测卡">莱克多巴胺-胶体金检测卡</option>
                                    <option value="沙丁胺醇-胶体金检测卡">沙丁胺醇-胶体金检测卡</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">检测结果 <span class="text-red-500">*</span></label>
                                <select name="result" class="w-full border border-gray-300 p-2 rounded-md shadow-sm" required>
                                    <option value="合格">合格</option>
                                    <option value="不合格">不合格</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="flex justify-end mt-4">
                            <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                                <i class="fas fa-save mr-2"></i>保存
                            </button>
                        </div>
                    </form>
                    <table class="w-full text-sm">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-2 border">日期</th>
                                <th class="p-2 border">食堂</th>
                                <th class="p-2 border">肉类品种</th>
                                <th class="p-2 border">检测项目</th>
                                <th class="p-2 border">结果</th>
                                <th class="p-2 border">检测员</th>
                                <th class="p-2 border">操作</th>
                            </tr>
                        </thead>
                        <tbody id="leanMeatRecords"></tbody>
                    </table>
                </div>
            </div>

            <!-- 6. 病原体检测 (Pathogen) - 新增 -->
            <div id="pathogen-test" class="content-section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold mb-4 border-b pb-2">食源性细菌/病毒检测 (导入)</h2>
                    <div class="bg-blue-50 border border-blue-200 p-4 rounded mb-4 text-sm text-blue-800">
                    支持导入 Word 文档(.docx)格式的病原体检测数据报告。
                    </div>
                    <div class="flex gap-4 items-end mb-6 border p-4 rounded bg-gray-50">
                        <div class="flex-1">
                            <label class="block text-sm mb-1">选择文件 (.json)</label>
                            <input type="file" id="pathogenFileInput" accept=".docx" class="w-full border p-2 rounded bg-white">
                        </div>
                        <button id="btnImportPathogen" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">导入</button>
                        <button id="btnDownloadTemplate" class="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700">下载模板</button>
                    </div>
                    <table class="w-full text-sm"><thead class="bg-gray-100"><tr><th class="p-2 border">日期</th><th class="p-2 border">样本ID</th><th class="p-2 border">食堂</th><th class="p-2 border">类型</th><th class="p-2 border">阳性项</th><th class="p-2 border">风险</th><th class="p-2 border">检测员</th><th class="p-2 border">操作</th></tr></thead><tbody id="pathogenRecords"></tbody></table>
                </div>
            </div>

            <!-- 7. 数据导出 - 新增 -->
            <div id="export-data" class="content-section hidden">
                <!-- ExportService.js 会动态填充完整的导出界面 -->
            </div>

        </div>
    </div>

    <!-- 模块入口 -->
    <script type="module" src="./js/main.js"></script>
</body>
</html>